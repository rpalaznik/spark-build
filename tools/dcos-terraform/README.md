# DCOS Terraform

### Using `make`
When running from `make` prerequisite environment variables can be modified by supplying arguments to make:
- `CLUSTER_USER`       (default: `bootstrapuser`)
- `CLUSTER_PASSWORD`   (default: `deleteme`)
- `CLUSTER_OWNER`      (default: current user)
- `CLUSTER_EXPIRATION` (default: 3 hours)
- `CLUSTER_ADMIN_IPS`  (default: "")

From the project root folder:
* `make cluster-create`
  * builds Docker container with Terraform included
  * generates SSH keys if they're not present in the current folder
  * copies AWS credentials file from `${HOME}/.aws/credentials` and if not available
  generates a new one based on `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` environment variables
  * runs `terraform init` followed by `terraform plan -out=plan.out` and `terraform apply plan.out`
* `make cluster-destroy` runs `terraform destroy` in the previously built Docker container
* `make terraform.clean` removes all generated and copied keys, credential files, and Terraform state files

Consult [terraform.mk](terraform.mk) for all the available fine-grained targets.

### Using vanilla Terraform

The following variables must be specified either in `terraform.tfvars` or via environment variables prefixed with `TF_VAR_`:
- `dcos_superuser_username`
- `dcos_superuser_password_hash` (can be generated by running: `docker run -it bernadinm/sha512 <text password>`)
- `cluster_owner` - your slack id
- `cluster_expiration`

When working with EE version of DCOS it is also important to provide a file with a valid license via `dcos_license_key_file`
property. Default value: `./license.txt`

AWS account credentials should be configured on a developer's machine. 

With Terraform installed locally:
```
terraform init
terraform plan -out plan.out
terraform apply plan.out
terraform destroy
```